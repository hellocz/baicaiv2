<!DOCTYPE html>
<html lang="zh-CN">
<head>
<include file="public:head" />
    <!--当前页面css-->
    <link rel="stylesheet" href="/public/css/login.css">
</head>
<body>
	<div class="w-1200">
		<!--页面头部start-->
		<div class="header">
			<div class="logo clearfix">
				<a href="/" class="fl">
					<svg class="icon-logo">
						<!--[if lte IE 8]><desc><img src="/public/images/ie8/logo_CAI.png" width="127" height="40"></desc><![endif]-->
						<use xlink:href="/public/images/svg_sprite/icon_symbol.svg#icon-logo_BAI"></use>
					</svg>
				</a>
				<div class="fl tit ml-24 font-16 fc-grey lvcenter">注册</div>
			</div>
			<a href="{:U('user/login')}" class="button radius-3">登录</a>
		</div>
		<!--页面头部end-->
		
		<!--页面内容start-->
		<div class="box">
			<!--注册start-->
			<div class="content">
				<div>
					<p class="font-36">创建账户</p>
					<p class="fc-aux-a font-16 mt-6">做一个精明的消费者</p>
				</div>
				<form id="J_register_form" action="{:U('user/register')}" method="post">
				<div class="mt-40">
					<div class="input input3 radius-3 mobile"><input type="text" placeholder="手机号码" maxlength="11" id="mobile" name="mobile" autocomplete="off"><input type="button" class="yzm" onclick="javascript: if(phone_send()) settime(this);" value="获取验证码"></div>
					<div class="input input4 radius-3 mt-14"><input type="text" placeholder="手机验证码" id="phone_verify" name="phone_verify" autocomplete="off"></div>
					<div class="input input1 radius-3 mt-14"><input type="text" placeholder="用户名" id="username" name="username" autocomplete="off"></div>
					<div class="input input2 radius-3 mt-14"><input type="password" placeholder="登录密码" id="password" name="password" autocomplete="off"></div>
					<div class="mt-24"><button type="submit" class="button btn-3 cursor-pointer" id="submit">创建账户</button></div>
					<div class="mt-10 fc-aux-9 text-center">尊敬的用户，点击创建账户按钮即说明您已阅读并同意白菜哦<a href="javascript: void(0);" class="a-green protocol">《用户服务协议》</a>以及<a href="javascript: void(0);" class="a-green">《隐私条款》</a></div>
					<div id="J_protocol" class="none">{:str_replace("\\n",'<br>',C('pin_reg_protocol'))}></div>
				</div>
				</form>
			</div>
			<!--注册end-->
		</div>
		<!--页面内容end-->
		
		<!--页面底部start-->
		<div class="footer fc-aux-9 text-center">
			<p>湘ICP备13002285号 · 公安备案湘公网安备 43011102000623号</p>
			<p class="mt-5">© 2018 Baicaio.com All rights reserved.</p>
		</div>
		<!--页面底部end-->
	</div>
	<!--引入layui JS文件-->
	<script src="/public/js/lib/layui/layui.js"></script>
	<script>
		//弹出对话层
		function dialogPopup(content){
			layer.open({
				type: 1,
				title: false,
				closeBtn: 1,
				shadeClose: false,
				shade:0.7,
				anim:2,
				skin: 'loginPopup',
				area: '430px',
				content: content //html or $('#id')
			});
		}
		$(".protocol").on("click", function(){
			dialogPopup($('#J_protocol'));
		});

		function checkMobile(mobile) {
			// return true;
			var re = /^1\d{10}$/
			if(mobile.length == 0){
				layer.tips('手机号不能为空', '.input3',{
					tips: [2, '#33CC99'],
					time: 2000
				});
				return false;
			}else if(!re.test(mobile)){
				layer.tips('手机号必须是11位数字', '.input3',{
					tips: [2, '#33CC99'],
					time: 2000
				});
				return false;
			}else{
				// $.post('/?m=user&a=ajax_check&type=username',{J_username:username},function(result){
				// 	if(result.status == 0){
				// 		layer.tips('这用户名已经被别人抢走啦，换一个吧', '.input1',{
				// 			tips: [2, '#33CC99'],
				// 			time: 2000
				// 		});
				// 		check = false;
				// 	}
				// },'json');

				var check = true;

				$.ajax({
					type: 'GET',
					url: '/?m=user&a=ajax_check&type=mobile',
					data:{J_mobile:mobile},
					dataType: 'json',
					async: false, //同步
					cache: false,
					success: function (result) {
						if(result.status != 1){
							layer.tips('这个手机号已经注册啦，换一个吧', '.input3',{
								tips: [2, '#33CC99'],
								time: 2000
							});
							check = false;
						}
					}
				});

				return check;
			}

			return true;
		}

		function phone_send() {

			var mobile = $("#mobile").val();
			if(!checkMobile(mobile)){
				return false;
			}

			$.post('/index.php?m=user&a=phone_send',{mobile:mobile},function(result){
				if(result.status == 0){
					// $(".msg").text(result.msg);
					tipsPopup('tips_1', result.msg);
				}else{
					layer.tips(result.msg, '.input3',{
						tips: [2, '#33CC99'],
						time: 2000
					});
				}
			},'json');

			return true;
		}

		layui.use('layer', function(){
			var layer = layui.layer;
		});
		
		//用户名密码登录表单验证
		$("#submit").on('click', function(){
			var mobile = $("#mobile").val();
			var phone_verify = $("#phone_verify").val();
			var username = $("#username").val();
			var password = $("#password").val();
			

			if(!checkMobile(mobile)){
				return false;
			}else if(phone_verify.length == 0){
				layer.tips('验证码不能为空', '.input4',{
					tips: [2, '#33CC99'],
					time: 2000
				});
				return false;
			}else if(username.length == 0){
				layer.tips('用户名/手机号/邮箱不能为空', '.input1',{
					tips: [2, '#33CC99'],
					time: 2000
				});
				return false;
			}else if(password.length == 0){
				layer.tips('密码不能为空', '.input2',{
					tips: [2, '#33CC99'],
					time: 2000
				});
				return false;
			}else{
				// $.post('/?m=user&a=ajax_check&type=username',{J_username:username},function(result){
				// 	if(result.status == 0){
				// 		layer.tips('这个用户名已经被别人抢走啦，换一个吧', '.input1',{
				// 			tips: [2, '#33CC99'],
				// 			time: 2000
				// 		});
				// 		check = false;
				// 	}
				// },'json');

				var check = true;

				$.ajax({
					type: 'GET',
					url: '/?m=user&a=ajax_check&type=username',
					data:{J_username:username},
					dataType: 'json',
					async: false, //同步
					cache: false,
					success: function (result) {
						if(result.status != 1){
							layer.tips('这个用户名已经被别人抢走啦，换一个吧', '.input1',{
								tips: [2, '#33CC99'],
								time: 2000
							});
							check = false;
						}
					}
				});

				return check;
			}

			
		});
	</script>
</body>
</html>